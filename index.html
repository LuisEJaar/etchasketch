<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Etchy-Sketchy</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="handHeld">
        <div class="headerSpace">
            <button id="clearGrid">Clear Grid</button>
        </div>
            
        <div class="userGrid">
            <label for="gridSize">Grid Size:</label>
            <input type="text" id="gridSize" name="gridSize">
            <button id="enter">Enter</button>
        </div>
        
        <div class="gameConsole">      
            <div id="viewPort"></div>
        </div>
        
        <div class= "bottomButtons">
            <button id="greyScale"> Grey Scale</button>
            <button id="rainbow">Rainbow</button>
            <button id="darken">Darken</button>
            <button id="eraser">Eraser</button>
        </div>
    </div>

</body>

<script>

    //function to set background color to class default
    const clearGrid = document.querySelector('#clearGrid');
    clearGrid.addEventListener('click', ()=> {
        var pixels = document.getElementById('viewPort').getElementsByTagName('div'); 
        for (i = 0; i < pixels.length; i++) {
            var pixel = pixels[i];
            pixel.style.backgroundColor = "";
            //pixel.style.opacity = 0;
        }
    });

    //function to create the grid
    function gridMaker16x16() {
        for(i=0; i<256;i++){
            const gridContainer = document.querySelector('#viewPort');
            const pixel = document.createElement('div');
            pixel.classList.add('pixel');
            gridContainer.appendChild(pixel);
        };
    };

    gridMaker16x16();

    //function to take user input and create a grid
    const enterButton = document.querySelector('#enter');
    
    enterButton.addEventListener('click',()=> {
        userinput = document.getElementById("gridSize");
        input = Number(userinput.value);

        if (input > 100) {
            console.log('thats too much work');
       } else {
            //remove old grid
            const gridContainer = document.querySelector('#viewPort'); 
            const pixels = document.getElementById('viewPort').getElementsByTagName('div');
            const iterations = pixels.length
            for (i = 0; i < iterations; i++) {
                const pixel = pixels[0];
                pixel.style.backgroundColor = "";
                gridContainer.removeChild(pixel);
                console.log(pixels.length);
            };
            //create new divs for grid
            for(i=0; i<(input**2);i++){
                const gridContainer = document.querySelector('#viewPort');
                const pixel = document.createElement('div');
                pixel.classList.add('pixel');
                gridContainer.appendChild(pixel);
            };
            document.getElementById("viewPort").style.gridTemplateColumns = `repeat(${input},1fr)`;
        };
        });
    
    //function to set initial color as greyscale
    function initialColor () {
        let viewPort = document.getElementById("viewPort");
        viewPort.addEventListener("mouseover", function(e) {
        e.target.style.backgroundColor = "grey";
        });
    };

    initialColor ();
    
    //function to set the mouseover as greyscale
    const greyScale = document.querySelector('#greyScale');
    greyScale.addEventListener('click', function (e) {
        let viewPort = document.getElementById("viewPort");
        
        viewPort.addEventListener("mouseover", function(e) {
        e.target.style.backgroundColor = "grey";
        });
    });

    //function to set mouseover as random colors
    const rainbow = document.querySelector('#rainbow');
    rainbow.addEventListener('click', function (e) {      
        let viewPort = document.getElementById("viewPort");
        viewPort.removeEventListener("mouseover", darker);
        viewPort.addEventListener("mouseover", function(e) {
            function random(number) {
            return Math.floor(Math.random() * (number+1));
            };
            const rndCol = `rgb(${random(255)}, ${random(255)}, ${random(255)})`;
            e.target.style.backgroundColor = rndCol;
            //added in most recently. Resolves going from darken to rainbow.
            //need to break rainbow into function call like darken
            //need to allow darken to cancel rainbows listener
            event.target.style.opacity = "";
        });
    });

    /*
    //Original, do not erase
    const darken = document.querySelector('#darken');
    darken.addEventListener('click', function (e) {
        let viewPort = document.getElementById("viewPort");
        viewPort.addEventListener("mouseover", function (e) {
            e.target.style.backgroundColor = "blue";
            if (e.target.style.opacity < 0.2) {
                e.target.style.opacity = "0.2";
            } else if (e.target.style.opacity >= 0.2){
                let current = Number(e.target.style.opacity) + 0.2;
                e.target.style.opacity = current;
            };
        });
    });
    */

    const darken = document.querySelector('#darken');
    darken.addEventListener('click', darkening);

    function darkening () {
        let viewPort = document.getElementById("viewPort");
        viewPort.addEventListener("mouseover", darker);    
        };
    
    function darker (event) {    
            event.target.style.backgroundColor = "blue";
        if (event.target.style.opacity < 0.2) {
            event.target.style.opacity = "0.2";
        } else if (event.target.style.opacity >= 0.2){
            let current = Number(event.target.style.opacity) + 0.2;
            event.target.style.opacity = current;
        };
    };

    rainbow.addEventListener('click', ()=> {
        viewPort.removeEventListener("mouseover", darker);   
    });

    greyScale.addEventListener('click', ()=> {
        viewPort.removeEventListener("mouseover", darker);   
    });

    //function to set mouseover to "erase" / set to class default
    const eraser = document.querySelector('#eraser');
    eraser.addEventListener('click', function (e) {       
        let viewPort = document.getElementById("viewPort");
        viewPort.addEventListener("mouseover", function(e) {
            e.target.style.backgroundColor = "";
        });
    });
    
</script>

</html>